<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Wettkampf – Gruppe auswählen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .container { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; }
    .groupBox {
      padding: 15px;
      margin: 10px 0;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
      text-align: center;
    }
    /* Gruppennamen in den Boxen: fett und schwarz */
    .groupBox strong {
      color: black;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Wettkampf erstellt</h1>
  
  <!-- Anzeige von Wettkampfname und Wettkampf-ID -->
  <div class="container">
    <p><strong>Wettkampfname:</strong> <span id="compNameDisplay"></span></p>
    <p><strong>Wettkampf-ID:</strong> <span id="compIdDisplay"></span></p>
    <p>Teile die Wettkampf-ID, damit andere dem Wettkampf beitreten können.</p>
  </div>
  
  <!-- Container für die Gruppenselektion (Summary-Boxen) -->
  <div class="container" id="groupsContainer">
    <h2>Gruppe auswählen</h2>
    <!-- Die Boxen werden hier dynamisch erstellt -->
  </div>
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-database-compat.js"></script>
  <script>
    // Firebase-Konfiguration – passe diese Werte ggf. an
    const firebaseConfig = {
      apiKey: "AIzaSyBj_ylDl8WgUnXbpwI1pfgWnvZSoQ9ML3A",
      authDomain: "wettkampf-f6f92.firebaseapp.com",
      databaseURL: "https://wettkampf-f6f92-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "wettkampf-f6f92",
      storageBucket: "wettkampf-f6f92.firebasestorage.app",
      messagingSenderId: "161090727748",
      appId: "1:161090727748:web:33f4ff7ce4f6e5c08f7111",
      measurementId: "G-WCV2950HGK"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    // Lese Wettkampfname und Wettkampf-ID aus der URL, z.B. ?compId=ABC123&compName=MeinWettkampf
    const params = new URLSearchParams(window.location.search);
    const compId = params.get("compId") || "Keine ID";
    const compName = params.get("compName") || "Kein Name";
    document.getElementById("compIdDisplay").textContent = compId;
    document.getElementById("compNameDisplay").textContent = compName;
    
    // Definiere die Gruppen und die Zielseiten
    const groups = [
      { id: "holz1", name: "Holz 1", target: "scoreboardholz1.html" },
      { id: "holz2", name: "Holz 2", target: "scoreboardholz2.html" },
      { id: "gummi1", name: "Gummi 1", target: "scoreboardgummi1.html" },
      { id: "gummi2", name: "Gummi 2", target: "scoreboardgummi2.html" }
    ];
    
    const groupBoxesContainer = document.getElementById("groupsContainer");
    
    // Erstelle für jede Gruppe eine Box, in der der Gruppenname und das Ergebnis angezeigt werden.
    function updateGroupBoxes() {
      // Leere den Container zunächst
      groupBoxesContainer.innerHTML = "<h2>Gruppe auswählen</h2>";
      
      groups.forEach(g => {
        // Lese die Daten der Gruppe aus Firebase (Pfad: competitions/{compId}/groups/{groupId}/scoreboard/topTeam)
        db.ref('competitions/' + compId + '/groups/' + g.id + '/scoreboard/topTeam').once('value')
          .then(snapshot => {
            const data = snapshot.val();
            const result = data && data.schoet ? data.schoet : 0;
            // Bestimme die Hintergrundfarbe: grün wenn leadership true, sonst rot; Fallback: grau
            const bgColor = data && typeof data.leadership === "boolean" ? (data.leadership ? "green" : "red") : "gray";
            
            // Erzeuge die Box
            const box = document.createElement("div");
            box.className = "groupBox";
            box.style.backgroundColor = bgColor;
            // Anstatt "Top Schoet" soll "Ergebnis" angezeigt werden.
            box.innerHTML = `<strong></strong><br>Ergebnis: `;
            box.addEventListener("click", () => {
              // Weiterleitung zur entsprechenden Scoreboard-Seite mit compId und compName als Parameter
              window.location.href = g.target + "?compId=" + encodeURIComponent(compId) +
                                      "&compName=" + encodeURIComponent(compName);
            });
            groupBoxesContainer.appendChild(box);
          })
          .catch(err => {
            console.error("Fehler beim Laden der Daten für " + g.name + ":", err);
            // Fallback-Box
            const box = document.createElement("div");
            box.className = "groupBox";
            box.style.backgroundColor = "gray";
            box.innerHTML = `<strong></strong><br>Ergebnis: 0`;
            box.addEventListener("click", () => {
              window.location.href = g.target + "?compId=" + encodeURIComponent(compId) +
                                      "&compName=" + encodeURIComponent(compName);
            });
            groupBoxesContainer.appendChild(box);
          });
      });
    }
    
    updateGroupBoxes();
  </script>
</body>
</html>