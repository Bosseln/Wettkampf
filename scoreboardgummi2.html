<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Boßeln Scoreboard – Gummi 2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { margin-bottom: 10px; }
    .team-header { color: #fff; padding: 10px; margin-bottom: 5px; }
    .red { background-color: red; }
    .green { background-color: green; }
    .table-container { overflow-x: auto; margin-bottom: 15px; }
    table { border-collapse: collapse; width: 100%; max-width: 900px; }
    th, td { border: 1px solid #000; padding: 5px; text-align: center; }
    input[type="text"] { width: 100px; }
    input[type="number"] { width: 60px; }
    .score-area { margin: 10px 0; font-size: 1.1em; }
    #genderSelect { margin-left: 10px; margin-right: 10px; }
    button#backBtn { padding: 10px 15px; font-size: 1em; cursor: pointer; margin-top: 20px; display: block; }
  </style>
</head>
<body>

<h1>Boßeln Scoreboard – Gummi 2</h1>

<!-- Geschlechtsauswahl -->
<div>
  <label for="genderSelect">Geschlecht:</label>
  <select id="genderSelect">
    <option value="men">Männer</option>
    <option value="women">Frauen</option>
  </select>
</div>

<br>

<!-- Oberes Team (Führung) – standardmäßig hat beim Start die untere Mannschaft Führung, also beginnt das obere Team ohne Führung -->
<div id="topTeam" class="team-header red">
  <!-- Keine manuellen Buttons mehr – die Erfassung erfolgt automatisch -->
  <input type="text" id="topVerein" placeholder="Verein eintragen..." />
  &nbsp;Schoet: <span id="topSchoetDisplay">0</span>
  &nbsp;Meter: <input type="number" id="topMeterInput" value="0" />
</div>

<!-- Tabelle für das obere Team -->
<div class="table-container">
  <table id="upperTable">
    <thead>
      <tr>
        <th>Runden</th>
        <!-- 15 Spalten für Runden -->
        <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th>
        <th>6</th><th>7</th><th>8</th><th>9</th><th>10</th>
        <th>11</th><th>12</th><th>13</th><th>14</th><th>15</th>
      </tr>
    </thead>
    <tbody>
      <!-- 5 Zeilen (4 Werfer + 1 Ersatz) – IDs beginnen mit gummi2_top_ -->
      <tr>
        <td><input type="text" id="gummi2_top_name0" placeholder="Werfer 1" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_1" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_2" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_3" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_4" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_5" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_6" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_7" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_8" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_9" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_10" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_11" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_12" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_13" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_14" /></td>
        <td><input type="checkbox" id="gummi2_top_cb0_15" /></td>
      </tr>
      <!-- Zeile 2 -->
      <tr>
        <td><input type="text" id="gummi2_top_name1" placeholder="Werfer 2" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_1" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_2" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_3" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_4" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_5" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_6" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_7" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_8" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_9" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_10" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_11" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_12" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_13" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_14" /></td>
        <td><input type="checkbox" id="gummi2_top_cb1_15" /></td>
      </tr>
      <!-- Zeile 3 -->
      <tr>
        <td><input type="text" id="gummi2_top_name2" placeholder="Werfer 3" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_1" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_2" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_3" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_4" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_5" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_6" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_7" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_8" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_9" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_10" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_11" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_12" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_13" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_14" /></td>
        <td><input type="checkbox" id="gummi2_top_cb2_15" /></td>
      </tr>
      <!-- Zeile 4 -->
      <tr>
        <td><input type="text" id="gummi2_top_name3" placeholder="Werfer 4" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_1" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_2" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_3" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_4" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_5" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_6" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_7" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_8" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_9" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_10" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_11" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_12" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_13" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_14" /></td>
        <td><input type="checkbox" id="gummi2_top_cb3_15" /></td>
      </tr>
      <!-- Zeile 5 (Ersatz) -->
      <tr>
        <td><input type="text" id="gummi2_top_name4" placeholder="Ersatz 1" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_1" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_2" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_3" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_4" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_5" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_6" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_7" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_8" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_9" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_10" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_11" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_12" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_13" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_14" /></td>
        <td><input type="checkbox" id="gummi2_top_cb4_15" /></td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Unteres Team (Führung) -->
<div id="bottomTeam" class="team-header green">
  <button id="bottomTeamToggleBtn">Führung</button>
  <input type="text" id="bottomVerein" placeholder="Verein eintragen..." />
  <button id="bottomSchoetBtn">Schöööööt!</button>
  <button id="bottomRemoveSchoetBtn" class="removeSchoetBtn">-1</button>
  &nbsp;Schoet: <span id="bottomSchoetDisplay">0</span>
  &nbsp;Meter: <input type="number" id="bottomMeterInput" value="0" />
</div>

<!-- Tabelle für das untere Team -->
<div class="table-container">
  <table id="lowerTable">
    <thead>
      <tr>
        <th>Runden</th>
        <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th>
        <th>6</th><th>7</th><th>8</th><th>9</th><th>10</th>
        <th>11</th><th>12</th><th>13</th><th>14</th><th>15</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="text" id="holz2_bottom_name0" placeholder="Werfer 1" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_1" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_2" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_3" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_4" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_5" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_6" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_7" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_8" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_9" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_10" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_11" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_12" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_13" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_14" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb0_15" /></td>
      </tr>
      <tr>
        <td><input type="text" id="holz2_bottom_name1" placeholder="Werfer 2" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_1" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_2" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_3" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_4" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_5" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_6" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_7" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_8" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_9" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_10" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_11" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_12" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_13" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_14" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb1_15" /></td>
      </tr>
      <tr>
        <td><input type="text" id="holz2_bottom_name2" placeholder="Werfer 3" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_1" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_2" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_3" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_4" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_5" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_6" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_7" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_8" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_9" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_10" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_11" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_12" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_13" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_14" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb2_15" /></td>
      </tr>
      <tr>
        <td><input type="text" id="holz2_bottom_name3" placeholder="Werfer 4" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_1" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_2" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_3" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_4" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_5" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_6" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_7" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_8" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_9" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_10" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_11" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_12" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_13" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_14" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb3_15" /></td>
      </tr>
      <tr>
        <td><input type="text" id="holz2_bottom_name4" placeholder="Ersatz 1" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_1" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_2" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_3" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_4" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_5" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_6" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_7" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_8" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_9" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_10" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_11" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_12" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_13" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_14" /></td>
        <td><input type="checkbox" id="holz2_bottom_cb4_15" /></td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Ergebnis-Anzeige -->
<div class="score-area">
  <strong>Ergebnis Schoet:</strong> <span id="ergebnisSchoet">0.0</span><br />
  <strong>Ergebnis Meter:</strong> <span id="ergebnisMeter">0</span>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-database-compat.js"></script>
<script>
  // Lese die Wettkampfdaten aus der URL – für diese Datei gilt die Gruppe "holz2"
  const params = new URLSearchParams(window.location.search);
  const compId = params.get("compId") || "Keine ID";
  // Gruppen-ID für Holz 2:
  const groupId = "holz2";
  
  // Firebase-Konfiguration – ggf. anpassen
  const firebaseConfig = {
    apiKey: "AIzaSyBj_ylDl8WgUnXbpwI1pfgWnvZSoQ9ML3A",
    authDomain: "wettkampf-f6f92.firebaseapp.com",
    databaseURL: "https://wettkampf-f6f92-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "wettkampf-f6f92",
    storageBucket: "wettkampf-f6f92.firebasestorage.app",
    messagingSenderId: "161090727748",
    appId: "1:161090727748:web:33f4ff7ce4f6e5c08f7111",
    measurementId: "G-WCV2950HGK"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  
  // Element-Referenzen
  const topTeam = document.getElementById("topTeam");
  const bottomTeam = document.getElementById("bottomTeam");
  
  const topTeamToggleBtn = document.getElementById("topTeamToggleBtn");
  const bottomTeamToggleBtn = document.getElementById("bottomTeamToggleBtn");
  
  // Die manuellen Schöt-Buttons entfernen – stattdessen erfolgt die Erfassung automatisch anhand der Checkboxen.
  // Wir behalten aber den "-1" Button (um Fehler zu korrigieren), falls gewünscht.
  const topRemoveSchoetBtn = document.getElementById("topRemoveSchoetBtn");
  const bottomRemoveSchoetBtn = document.getElementById("bottomRemoveSchoetBtn");
  
  const topSchoetDisplay = document.getElementById("topSchoetDisplay");
  const bottomSchoetDisplay = document.getElementById("bottomSchoetDisplay");
  
  const topMeterInput = document.getElementById("topMeterInput");
  const bottomMeterInput = document.getElementById("bottomMeterInput");
  
  const ergebnisSchoet = document.getElementById("ergebnisSchoet");
  const ergebnisMeter = document.getElementById("ergebnisMeter");
  
  const genderSelect = document.getElementById("genderSelect");
  
  // Globale Variablen für errechnete Erfolge (Schöt)
  let topSchoet = 0;
  let bottomSchoet = 0;
  
  // Wir benötigen außerdem Variablen, um die Anzahl der Checkboxen bei der letzten Berechnung zu speichern
  let lastTopCount = 0;
  let lastBottomCount = 0;
  
  // Hilfsfunktion: Zählt die gesetzten Checkboxen in einer Tabelle
  function countCheckboxes(tableId) {
    const table = document.getElementById(tableId);
    let count = 0;
    const inputs = table.querySelectorAll("input[type='checkbox']");
    inputs.forEach(input => { if (input.checked) count++; });
    return count;
  }
  
  // Speichern des Zustands in Firebase (inkl. Tabellen und Ergebnis-Anzeige)
  function saveState() {
    const state = {
      topTeam: {
        verein: document.getElementById("topVerein").value,
        schoet: topSchoet,
        meter: Number(topMeterInput.value),
        leadership: topTeam.classList.contains("green")
      },
      bottomTeam: {
        verein: document.getElementById("bottomVerein").value,
        schoet: bottomSchoet,
        meter: Number(bottomMeterInput.value),
        leadership: bottomTeam.classList.contains("green")
      },
      resultSchoet: ergebnisSchoet.textContent,
      resultMeter: ergebnisMeter.textContent,
      gender: genderSelect.value,
      upperTable: saveTable("upperTable"),
      lowerTable: saveTable("lowerTable")
    };
    db.ref('competitions/' + compId + '/groups/' + groupId + '/scoreboard').set(state);
  }
  
  function saveTable(tableId) {
    const table = document.getElementById(tableId);
    let data = [];
    const rows = table.tBodies[0].rows;
    for (let i = 0; i < rows.length; i++) {
      let rowData = [];
      let row = rows[i];
      for (let j = 0; j < row.cells.length; j++) {
        let input = row.cells[j].querySelector("input");
        if (input) {
          if (input.type === "checkbox") {
            rowData.push(input.checked);
          } else {
            rowData.push(input.value);
          }
        } else {
          rowData.push(null);
        }
      }
      data.push(rowData);
    }
    return data;
  }
  
  // Laden des Zustands aus Firebase
  function loadState() {
    db.ref('competitions/' + compId + '/groups/' + groupId + '/scoreboard').once('value')
      .then(snapshot => {
        const state = snapshot.val();
        if (state) {
          document.getElementById("topVerein").value = state.topTeam.verein || "";
          topSchoet = state.topTeam.schoet || 0;
          topSchoetDisplay.textContent = topSchoet;
          topMeterInput.value = state.topTeam.meter || 0;
          if (state.topTeam.leadership) {
            topTeam.classList.add("green");
            topTeam.classList.remove("red");
          } else {
            topTeam.classList.add("red");
            topTeam.classList.remove("green");
          }
          
          document.getElementById("bottomVerein").value = state.bottomTeam.verein || "";
          bottomSchoet = state.bottomTeam.schoet || 0;
          bottomSchoetDisplay.textContent = bottomSchoet;
          bottomMeterInput.value = state.bottomTeam.meter || 0;
          if (state.bottomTeam.leadership) {
            bottomTeam.classList.add("green");
            bottomTeam.classList.remove("red");
          } else {
            bottomTeam.classList.add("red");
            bottomTeam.classList.remove("green");
          }
          
          if (state.gender) genderSelect.value = state.gender;
          if (state.upperTable) loadTable("upperTable", state.upperTable);
          if (state.lowerTable) loadTable("lowerTable", state.lowerTable);
          ergebnisSchoet.textContent = state.resultSchoet || "0.0";
          ergebnisMeter.textContent = state.resultMeter || "0";
          // Setze die letzten Zähler auf den geladenen Zustand:
          lastTopCount = countCheckboxes("upperTable");
          lastBottomCount = countCheckboxes("lowerTable");
          calculateResult();
        }
      })
      .catch(err => {
        console.error("Fehler beim Laden des Zustands:", err);
      });
  }
  
  function loadTable(tableId, data) {
    const table = document.getElementById(tableId);
    const rows = table.tBodies[0].rows;
    if (!data) return;
    for (let i = 0; i < rows.length && i < data.length; i++) {
      let row = rows[i];
      for (let j = 0; j < row.cells.length && j < data[i].length; j++) {
        let input = row.cells[j].querySelector("input");
        if (input) {
          if (input.type === "checkbox") {
            input.checked = data[i][j];
          } else {
            input.value = data[i][j];
          }
        }
      }
    }
  }
  
  // Statt der manuellen Schöt- und Führungsbuttons erfolgt nun die automatische Erfassung:
  // Wir fügen einen Change-Listener zu allen Checkboxen hinzu.
  function addTableInputListeners() {
    const inputs = document.querySelectorAll("input[type='checkbox']");
    inputs.forEach(input => {
      input.addEventListener("change", calculateResult);
    });
  }
  addTableInputListeners();
  
  // Neue calculateResult()-Funktion: Erfasst automatisch die Erfolgszahlen anhand der Checkboxen.
  // Wir nutzen globale Variablen lastTopCount und lastBottomCount, um die Zunahme zu ermitteln.
  function calculateResult() {
    // Zähle aktuell gesetzte Checkboxen
    const currentTopCount = countCheckboxes("upperTable");
    const currentBottomCount = countCheckboxes("lowerTable");
    
    // Berechne die Differenz seit der letzten Messung
    const diffTop = currentTopCount - lastTopCount;
    const diffBottom = currentBottomCount - lastBottomCount;
    
    // Für das Team, das Führung hat, werden neue Erfolge direkt als Schöt gewertet
    if (topTeam.classList.contains("green")) {
      if (diffTop > 0) {
        topSchoet += diffTop;
        if(diffTop > 0) alert("Schöööt!");
      }
    } else {
      // Hat das Team ohne Führung mindestens 2 neue Haken (in Folge) gesetzt, wechselt die Führung
      if (diffTop >= 2) {
        topTeam.classList.add("green");
        topTeam.classList.remove("red");
        bottomTeam.classList.add("red");
        bottomTeam.classList.remove("green");
      }
    }
    
    if (bottomTeam.classList.contains("green")) {
      if (diffBottom > 0) {
        bottomSchoet += diffBottom;
        if(diffBottom > 0) alert("Schöööt!");
      }
    } else {
      if (diffBottom >= 2) {
        bottomTeam.classList.add("green");
        bottomTeam.classList.remove("red");
        topTeam.classList.add("red");
        topTeam.classList.remove("green");
      }
    }
    
    // Aktualisiere die Anzeige der Schöt-Zähler
    topSchoetDisplay.textContent = topSchoet;
    bottomSchoetDisplay.textContent = bottomSchoet;
    
    // Aktualisiere die "letzten" Zähler
    lastTopCount = currentTopCount;
    lastBottomCount = currentBottomCount;
    
    // Meter-Berechnung (wie bisher)
    let meterDiff = parseInt(topMeterInput.value) - parseInt(bottomMeterInput.value);
    let extraSchoet = Math.floor(Math.abs(meterDiff) / ((genderSelect.value === "men") ? 150 : 100));
    if (meterDiff > 0) {
      meterDiff = meterDiff % ((genderSelect.value === "men") ? 150 : 100);
    } else if (meterDiff < 0) {
      meterDiff = - (Math.abs(meterDiff) % ((genderSelect.value === "men") ? 150 : 100));
    }
    
    // Setze das Gesamtergebnis als Differenz der Schöt-Werte
    const totalDiff = topSchoet - bottomSchoet;
    ergebnisSchoet.textContent = totalDiff.toFixed(1);
    ergebnisMeter.textContent = meterDiff.toFixed(0);
    
    saveState();
  }
  
  // Lade den gespeicherten Zustand beim Start
  loadState();
  
  // Zurück-Button: Speichert Zustand und navigiert zurück zur Gruppenselektionsseite
  const backBtn = document.createElement("button");
  backBtn.textContent = "Zurück";
  backBtn.style.padding = "10px 15px";
  backBtn.style.fontSize = "1em";
  backBtn.style.cursor = "pointer";
  backBtn.addEventListener("click", () => {
    saveState();
    window.location.href = "scoreboard.html?compId=" + encodeURIComponent(compId);
  });
  document.body.appendChild(backBtn);
</script>
</body>
</html>